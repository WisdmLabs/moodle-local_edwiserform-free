{"version":3,"sources":["new_form_main.js"],"names":["define","$","ajax","notification","Templates","get_form_def","get_form_settings","formeo","SELECTORS","FORMTYPE","COMPONENT","FORM_STYLE","RENDER_FORM","PANEL","TEMPLATE_OVERLAY","TITLE","ACTIVE","FORM_TITLE","container","document","querySelector","renderContainer","saved","formeoOpts","svgSprite","M","cfg","wwwroot","localStorage","PROMISES","GET_TEMPLATE","type","call","methodname","args","name","CREATE_NEW_FORM","settings","formdef","setting","toString","UPDATE_FORM","can_save_form","status","check_template","check_title","empty_form_definition","parents","toggleClass","length","switch_panel","id","removeClass","concat","addClass","showError","arguments","undefined","active","attr","emptytitle","title","dom","toaster","util","get_string","JSON","parse","Object","keys","fields","save_form_settings","action","callable","done","fail","ex","alert","message","change_heading","formName","text","show","hide","select_template","formtype","template","val","changeEvent","CustomEvent","target","dispatchEvent","Formeo","trigger","resetForm","loading","response","loadingClose","definition","exception","get_pro_demo_url","video","videotypes","hasOwnProperty","description","notifi_email","draftitemid","data_edit","prop","formData","init","sitekey","prourl","ready","e","formdefinition","click","this","closest","mouseenter","find","css","offset","top","mouseleave","label","parent","detach","prependTo","data","on","event","detail","collapsed","preventDefault","eleCont","render","validator","validate","formid","_action","form_create_action","window","onbeforeunload","msg","reset","location","setTimeout","form_update_action","multiActions","keyup","empty","change","proWarning","_this","select","initializeEvents"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'local_edwiserform/efb_form_basic_settings',\n    'local_edwiserform/formbuilder'\n    ], function ($, ajax, notification, Templates) {\n\n    var SELECTORS = {\n        FORMTYPE: '#id_type',\n        COMPONENT: 'local_edwiserform',\n        FORM_STYLE: '.efb-form-style',\n        RENDER_FORM: '.render-form',\n        PANEL: '.efb-panel-btn',\n        TEMPLATE_OVERLAY: '.efb-forms-template-overlay',\n        TITLE: '#id_title',\n        ACTIVE: 'active',\n        FORM_TITLE: '#efb-form-title'\n    };\n\n    let container = document.querySelector('.build-form');\n    let renderContainer = document.querySelector(SELECTORS.RENDER_FORM);\n    let saved = false;\n    var fastselect = null;\n    var get_form_def;\n    var get_form_settings;\n    var formeo;\n    let formeoOpts = {\n        container: container,\n        svgSprite: M.cfg.wwwroot + '/local/edwiserform/pix/formeo-sprite.svg',\n        localStorage: false,\n    };\n\n    var PROMISES = {\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {String}  type Type of form\n         * @return {Promise}      Ajax promise call\n         */\n        GET_TEMPLATE: function(type) {\n            return ajax.call([{\n                methodname: 'edwiserform_get_template',\n                args: {\n                    name: type\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings JSON form settings\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        CREATE_NEW_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_create_new_form\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        },\n        /**\n         * Call moodle service edwiser_get_template\n         * @param  {Object}  settings form settings object\n         * @param  {String}  formdef  JSON form definition\n         * @return {Promise}          Ajax promise call\n         */\n        UPDATE_FORM: function(settings, formdef) {\n            return ajax.call([{\n                methodname: \"edwiserform_update_form_settings\",\n                args: {\n                    setting: settings,\n                    formdef: formdef.toString()\n                }\n            }])[0];\n        }\n    };\n\n    /**\n     * Check whether admin/teacher can save current form\n     * @return {Boolean} True is admin/teacher can save form\n     */\n    function can_save_form() {\n        var status = check_template() && check_title(false) && !empty_form_definition();\n        $('#efb-btn-save-form-settings').parents('.efb-editor-button').toggleClass('d-none', !status);\n        $('.efb-form-save').toggleClass('d-none', !status);\n        return status;\n    };\n\n    /**\n     * Get pro feature demo url of youtube video\n     * @param  {string} video type of feature\n     * @return {string}       Youtube embed video url\n     */\n    var get_pro_demo_url = (video) => {\n        return videotypes.hasOwnProperty(video) ? videotypes[video] : videotypes['default'];\n    }\n\n    /**\n     * Reset form definition to selected template\n     */\n    var reset_form = function() {\n        formeo.dom.loading();\n        var formtype = $(SELECTORS.FORMTYPE).val();\n        PROMISES.GET_TEMPLATE(formtype)\n        .done(function(response) {\n            formeo.dom.loadingClose();\n            if (response.status == true) {\n                formeoOpts.container = container;\n                formeo = new Formeo(formeoOpts, response.definition);\n                return;\n            }\n        }).fail(function(ex) {\n            formeo.dom.loadingClose();\n            notification.exception(ex);\n        });\n    };\n\n    formeoOpts.resetForm = reset_form;\n    formeoOpts.get_pro_demo_url = get_pro_demo_url;\n\n    /**\n     * Check whether template is selected or not\n     * @return {Boolean} False if not selected\n     */\n    function check_template() {\n        return $('.efb-forms-template.active').length > 0;\n    }\n\n    /**\n     * Switch between panel\n     * @param  {String} id Panel id\n     */\n    function switch_panel(id) {\n        $(SELECTORS.PANEL).removeClass(SELECTORS.ACTIVE);\n        $(`#efb-${id}`).addClass(SELECTORS.ACTIVE);\n        $('.efb-tabcontent').removeClass(SELECTORS.ACTIVE);\n        $(`#efb-cont-${id}`).addClass(SELECTORS.ACTIVE);\n    }\n\n    /**\n     * Check title of form and prevent from switching template\n     * @param  {Boolean} showError if true then error will be shown\n     * @return {Boolean}           True if title is empty\n     */\n    function check_title(showError = true) {\n        settings = get_form_settings();\n        var active = $('.efb-panel-btn.active').attr('id');\n        var emptytitle = settings.title != '';\n        if (!showError) {\n            return emptytitle;\n        }\n        if (!emptytitle) {\n            switch(active) {\n                case 'efb-form-setup':\n                case 'efb-form-builder':\n                case 'efb-form-preview':\n                    switch_panel('form-settings');\n                case 'efb-form-settings':\n                    $(SELECTORS.TITLE).parents('.fitem').addClass('has-danger');\n                    break;\n            }\n            formeo.dom.toaster(M.util.get_string('lbl-title-warning', SELECTORS.COMPONENT), 3000);\n        } else {\n            $('.efb-form-title-container').removeClass('has-danger');\n            $(SELECTORS.TITLE).parents('.fitem').removeClass('has-danger');\n        }\n        return emptytitle;\n    }\n\n    /**\n     * Get form settings\n     * @return {Object} form settings\n     */\n    get_form_settings = function() {\n        var type = $(SELECTORS.FORMTYPE).val();\n        var data = {\n            \"title\": $(\"#id_title\").val(),\n            \"description\": $(\"#id_description\").val(),\n            \"type\": type,\n            \"notifi_email\": $(\"#id_notifi_email\").val(),\n            \"message\": $(\"#id_confirmation_msg\").val(),\n            \"draftitemid\": $('[name=\"confirmation_msg[itemid]\"]').val(),\n            \"data_edit\": $(\"#id_editdata\").prop('checked')\n        };\n        return data;\n    }\n\n    /**\n     * Get form definition from formeo object\n     * @return {Object} Json form data\n     */\n    get_form_def = function() {\n        return formeo.formData;\n    }\n\n    /**\n     * Check if form is empty\n     * @return {Boolean} True if empty\n     */\n    function empty_form_definition() {\n        formdef = JSON.parse(get_form_def());\n        return Object.keys(formdef.fields).length == 0;\n    }\n\n    /**\n     * Call ajax service to save form settings\n     * @param {String}   action     Service name\n     * @param {Object}   settings   Form settings\n     * @param {String}   formdef    Form definition\n     * @param {Function} callable   Callback function\n     */\n    function save_form_settings(action, settings, formdef, callable) {\n        (action == 'create' ? PROMISES.CREATE_NEW_FORM(settings, formdef) : PROMISES.UPDATE_FORM(settings, formdef))\n        .done(callable).fail(function (ex) {\n            formeo.dom.alert('danger', ex.message);\n        });\n    }\n\n    /**\n     * Change heading of form\n     * @param  {String} formName Name of form\n     */\n    function change_heading(formName) {\n        $(\".efb-form-title\").text(formName);\n        $(\".efb-editor-action\").toggleClass(\"efb-hide\", formName.length < 0);\n        if (formName.length < 0) {\n            $(\"#id_error_template_title\").show();\n        } else {\n            $(\"#id_error_template_title\").hide();\n        }\n    }\n\n    /**\n     * Select clicked/choosen template\n     * @param  {String} formtype Form type\n     * @param  {String} template template definition\n     */\n    function select_template(formtype, template = '') {\n        $(SELECTORS.FORMTYPE).val(formtype);\n        var changeEvent = new CustomEvent(\"change\", {target: $(SELECTORS.FORMTYPE)[0]});\n        $(SELECTORS.FORMTYPE)[0].dispatchEvent(changeEvent);\n        formeoOpts.container = container;\n        formeo = new Formeo(formeoOpts, template);\n        $(\"#efb-form-settings\").trigger('click');\n    }\n\n    /**\n     * Innitialize form events\n     */\n    function initializeEvents() {\n        $('.efb-form-style-container .controls-toggle').click(function() {\n            $(this).parents('.preview-form').toggleClass('show-styles');\n            $('#efb-cont-form-builder .formeo-controls').closest('.build-form').toggleClass('hidden-controls');\n        });\n        $(SELECTORS.FORM_STYLE).mouseenter(function() {\n            $('.form-style-preview').attr('src', $(this).find('img').attr('src')).css('top', $(this).offset().top).show();\n        }).mouseleave(SELECTORS.FORM_STYLE, function() {\n            $('.form-style-preview').attr('src', '').hide();\n        });\n\n        let label = $('#id_allowsubmissionsfromdate_enabled').parent();\n        let container = $(label).parent();\n        label.detach().prependTo(container);\n        label = $('#id_allowsubmissionstodate_enabled').parent();\n        container = $(label).parent();\n        label.detach().prependTo(container);\n\n        $('.efb-settings-tab-list-item').click(function() {\n            $('.efb-settings-tab-list-item').removeClass(SELECTORS.ACTIVE);\n            $(this).addClass(SELECTORS.ACTIVE);\n            $('.efb-settings-tab').removeClass(SELECTORS.ACTIVE);\n            $(`#${$(this).data('target')}`).addClass(SELECTORS.ACTIVE);\n        });\n\n        $(document).on('formeoUpdated', function(event) {\n            can_save_form();\n        });\n        $(document).on('controlsCollapsed', function(event) {\n            $('.efb-form-step-preview').toggleClass('collapsed', event.detail.collapsed);\n        });\n\n        $(\".efb-form-step\").click(function(event) {\n            event.preventDefault();\n            var id = $(this).data('id');\n            $('#' + id).click();\n        });\n        $(\".efb-panel-btn\").click(function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            var id = $(this).attr('id');\n            if (id != 'efb-form-setup' && id != 'efb-form-settings' && !check_title()) {\n                return 0;\n            }\n            can_save_form();\n            var eleCont = $(this).data(\"panel\");\n            $(\"#efb-form-settings, #efb-form-builder, #efb-form-preview, #efb-form-setup\").removeClass(\"active\");\n            $(\"#efb-cont-form-settings, #efb-cont-form-builder, #efb-cont-form-preview, #efb-cont-form-setup\").removeClass(\"active\");\n\n            $(eleCont).addClass(\"active\");\n            $(this).addClass(\"active\");\n            $(\".efb-forms-panel-heading\").text($(this).data(\"panel-lbl\"));\n\n            if (\"#efb-cont-form-preview\" == eleCont) {\n                formeo.render(renderContainer);\n            }\n        });\n\n        // This will save the form settings using ajax.\n        $(\"body\").on(\"click\", \"#efb-btn-save-form-settings\", function (event) {\n            if (!check_template()) {\n                formeo.dom.toaster(M.util.get_string('select-template-warning', SELECTORS.COMPONENT), 3000);\n                switch_panel('form-setup');\n                event.preventDefault();\n                return;\n            }\n            if (!check_title() || !formeo.validator.validate()) {\n                return 0;\n            }\n            var settings = get_form_settings();\n            var formdef = get_form_def();\n            var formid = $(\"[name='id']\").val();\n            var action = \"create\";\n            var form_create_action = function (response) {\n                if (response.status == true) {\n                    saved = true;\n                    window.onbeforeunload = null;\n                    formeo.dom.alert('success', response.msg, function() {\n                        formeo.reset();\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    });\n                    setTimeout(function() {\n                        $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                    }, 4000);\n                } else {\n                    formeo.dom.alert('danger', response.msg);\n                }\n            }\n            if (formid) {\n                var form_update_action = function (response) {\n                    if (response.status == true) {\n                        window.onbeforeunload = null;\n                        formeo.dom.multiActions(\n                            'success',\n                            M.util.get_string(\"success\", SELECTORS.COMPONENT),\n                            response.msg,\n                            [{\n                                title: M.util.get_string(\"heading-listforms\", SELECTORS.COMPONENT),\n                                type: 'primary',\n                                action: function() {\n                                    $(location).attr('href', M.cfg.wwwroot + \"/local/edwiserform/view.php?page=listforms\");\n                                }\n                            }, {\n                                title: M.util.get_string(\"close\", SELECTORS.COMPONENT),\n                                type: 'default'\n                            }]\n                        );\n                    } else {\n                        formeo.dom.alert('danger', response.msg);\n                    }\n                }\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"forms-update-confirm\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string(\"forms-update-create-new\", SELECTORS.COMPONENT),\n                        type: 'primary',\n                        action: function() {\n                            save_form_settings(action, settings, formdef, form_create_action);\n                        }\n                    }, {\n                        title: M.util.get_string(\"forms-update-overwrite-existing\", SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: function() {\n                            action = \"update\";\n                            settings[\"id\"] = formid;\n                            save_form_settings(action, settings, formdef, form_update_action);\n                        }\n                    }]\n                );\n                return;\n            }\n            if (!saved) {\n                save_form_settings(action, settings, formdef, form_create_action);\n            } else {\n                formeo.dom.toaster(M.util.get_string('form-setting-saved', SELECTORS.COMPONENT), 3000);\n            }\n        });\n\n        $(SELECTORS.FORM_TITLE).keyup(function () {\n            var formName = $(this).val();\n            var empty = formName == '';\n            $(this).parent().toggleClass('has-danger', empty);\n            $(\"#id_title\").val(formName);\n            change_heading(formName);\n        }).change(function() {\n            can_save_form();\n        });\n        $(\"#id_title\").keyup(function () {\n            var formName = $(this).val();\n            $(\"#id_title\").val(formName);\n            change_heading(formName);\n        }).change(function() {\n            var formName = $(this).val();\n            $(SELECTORS.FORM_TITLE).val(formName);\n            can_save_form();\n        });\n\n\n        $(SELECTORS.FORMTYPE).change(function() {\n            $(\".efb-forms-template\").removeClass(\"active\");\n            var type = $(this).val();\n            $(\"#efb-forms-template-\" + type).addClass(\"active\");\n            $('#id_registration-enabled').prop('checked', true);\n        });\n\n        $(\".efb-forms-template.pro\").click(function() {\n            formeo.dom.proWarning({\n                type: $(this).find('.efb-forms-template-name').text(),\n                video: $(this).data('template'),\n                message: $(this).find('.efb-forms-template-details .desc').text()\n            });\n        });\n        $(\".efb-forms-template-select\").click(function(event){\n            var _this = this;\n            can_save_form();\n            var select = function() {\n                var formtype = $(_this).data(\"template\");\n                $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).addClass('loading');\n                PROMISES.GET_TEMPLATE(formtype)\n                .done(function(response) {\n                    $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n                    if (response.status == true) {\n                        select_template(formtype, response.definition);\n                        return;\n                    }\n                    formeo.dom.alert('warning', response.msg, function() {\n                        select_template(formtype, response.definition);\n                    });\n                }).fail(function(ex) {\n                    $(_this).parents(SELECTORS.TEMPLATE_OVERLAY).removeClass('loading');\n                    formeo.dom.alert('danger', ex.message);\n                });\n            }\n            if ($(\".efb-forms-template.active\").length && !empty_form_definition()) {\n                formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string(\"attention\", SELECTORS.COMPONENT),\n                    M.util.get_string(\"template-change-warning\", SELECTORS.COMPONENT),\n                    [{\n                        title: M.util.get_string('proceed', SELECTORS.COMPONENT),\n                        type: 'warning',\n                        action: select\n                    }, {\n                        title: M.util.get_string('cancel', SELECTORS.COMPONENT),\n                        type: 'success'\n                    }]\n                );\n            } else {\n                select();\n            }\n        });\n\n        can_save_form();\n    }\n\n    var init = function(sitekey, prourl) {\n        formeoOpts.sitekey = sitekey;\n        formeoOpts.prourl = prourl;\n        $(document).ready(function (e) {\n            if (typeof formdefinition != 'undefined') {\n                formeo = new Formeo(formeoOpts, formdefinition);\n            } else {\n                formeoOpts.localStorage = true;\n                formeo = new Formeo(formeoOpts);\n            }\n            initializeEvents();\n            $('#id_type').closest('.fitem').hide();\n            $('#root-page-loading').hide();\n            $('.efb-form-builder-wrap').show();\n        });\n    }\n    return {\n        init: init\n    };\n});\n"],"file":"new_form_main.js"}