define(["jquery","core/ajax","local_edwiserform/jszip","local_edwiserform/jquery.dataTables","local_edwiserform/dataTables.bootstrap4","local_edwiserform/dataTables.buttons","local_edwiserform/buttons.html5"],function(e,t){return{init:function(){e(document).ready(function(o){if(0!=e(".efb-wrap-list").data("sesskey")){e(".efb-wrap-list").data("sesskey");var a=e("#efb-forms").DataTable({paging:!0,ordering:!0,bProcessing:!0,bServerSide:!0,rowId:"DT_RowId",bDeferRender:!0,sAjaxSource:M.cfg.wwwroot+"/local/edwiserform/classes/external/get_forms.php",dom:'<"efb-top"<"efb-listing"l><"efb-list-filtering"f>>t<"efb-bottom"<"efb-form-list-info"i><"efb-list-pagination"p>><"efb-shortcode-copy-note">',columns:[{data:"title"},{data:"type"},{data:"id",orderable:!1},{data:"author"},{data:"created"},{data:"author2"},{data:"modified"},{data:"actions",orderable:!1}],language:{sSearch:M.util.get_string("efb-search-form","local_edwiserform")},fnRowCallback:function(t,o,a,l){e("td:eq(0)",t).addClass("efb-tbl-col-title"),e("td:eq(1)",t).addClass("efb-tbl-col-type"),e("td:eq(2)",t).addClass("efb-tbl-col-shortcode"),e("td:eq(3)",t).addClass("efb-tbl-col-create"),e("td:eq(4)",t).addClass("efb-tbl-col-modified"),e("td:eq(5)",t).addClass("efb-tbl-col-action-list")},drawCallback:function(t){e(".efb-csv-export").removeClass("dt-button").off(),e(".efb-shortcode-copy-note").html(M.util.get_string("clickonshortcode","local_edwiserform"))}})}function l(t,o){var a,l,d;t?(a="bg-warning bg-danger",l="bg-success",d=M.util.get_string("success","local_edwiserform")):(a="bg-success bg-warning",l="bg-danger",d=M.util.get_string("danger","local_edwiserform")),e("#efb-modal #efb-modal-header").removeClass(a).addClass(l).children(".modal-title").html(d),e("#efb-modal #efb-modal-body").html(`<h5>${o}</h5>`),e("#efb-modal").addClass("show deleted").removeClass("pro delete")}function d(t){var o=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),a=e(`<div id='${o}' class='efb-toaster toaster-container'>\n                      <lable class='toaster-message'>${t}</lable>\n                    </div>`);e("body").append(a),e(a).addClass("show"),setTimeout(function(){e(a).addClass("fade"),setTimeout(function(){e(a).removeClass("fade"),setTimeout(function(){e(a).remove()},300)},2e3)})}e(".efb-modal-close").click(function(){e("#efb-modal").removeClass("show")}),e("body").on("click",".efb-form-delete",function(t){t.preventDefault();var o=e(this).data("formid"),a=e(this).parents("tr"),l=e(a).children(".efb-tbl-col-title").text();e("#efb-modal #efb-modal-header").removeClass("bg-success").addClass("bg-warning").children(".modal-title").html(M.util.get_string("warning","local_edwiserform")),e("#efb-modal #efb-modal-body").html(`<h5>${M.util.get_string("efb-delete-form-and-data","local_edwiserform",{title:l,id:o})}</h5>`),e("#efb-modal").addClass("show delete").removeClass("pro deleted"),e("#efb-modal .efb-modal-delete-form").data("formid",o)}),e("body").on("click",".efb-modal-delete-form",function(o){o.preventDefault();var d=e(this).data("formid"),s=e(`#efb-form-id-${d}`);e(s).children(".efb-tbl-col-title").text();t.call([{methodname:"edwiserform_delete_form",args:{id:d}}])[0].done(function(t){e(".efb-modal-close").click(),1==t.status&&a.row(s).remove().draw(),l(t.status,t.msg)}).fail(function(t){e(".efb-modal-close").click(),l(!1,t.msg)})}),e("body").on("click",".efb-form-export",function(t){t.preventDefault(),e("#efb-modal #efb-modal-header").addClass("bg-success").removeClass("bg-warning").children(".modal-title").html(M.util.get_string("upgrade","local_edwiserform"));var o=M.util.get_string("hey-wait","local_edwiserform"),a=M.util.get_string("export-pro-message","local_edwiserform");a=M.util.get_string("profeaturemessage","local_edwiserform",{type:o,message:a}),e("#efb-modal #efb-modal-body").html(`<h5>${a}</h5>`),e("#efb-modal").addClass("show pro").removeClass("delete deleted")}),e("body").on("click",".efb-enable-disable-form",function(o){!function(o){var a=e(o).data("formid");t.call([{methodname:"edwiserform_enable_disable_form",args:{id:a,action:!e(o).is(":checked")}}])[0].done(function(t){t.status?e(o).prop("checked",e(o).is(":checked")):e(o).prop("checked",!e(o).is(":checked")),e(o).parent().attr("title",e(o).is(":checked")?e(o).data("disable-title"):e(o).data("enable-title"))}).fail(function(e){console.log(e)})}(e(this).prev())}),e("body").on("click",".efb-tbl-col-shortcode",function(t){var o=e("<input>");e("body").append(o);var a=e(this).text();o.val(a).select(),document.execCommand("copy"),o.remove(),d(M.util.get_string("shortcodecoppied","local_edwiserform",a))})})}}});