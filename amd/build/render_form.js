define(["jquery","core/ajax","local_edwiserform/formviewer"],function(e,t){return{init:function(a){e(document).ready(function(n){let r={container:"",sitekey:a,localStorage:!1};var o=[],i=e(".edwiserform-container");function c(a,n,r,o,i,c,s,f=null){e(r).text(i),t.call([{methodname:"edwiserform_submit_form_data",args:{formid:c,data:s}}])[0].done(function(t){var r;t.status?(e(a).html(t.msg),n.dom.alert("success",t.msg),null!=f&&f(a,s)):(n.dom.alert("warning",t.msg),t.hasOwnProperty("errors")&&(r=t.errors,r=JSON.parse(r),e(".custom-validation-error").remove(),e.each(r,function(t,a){var n=e(`#${t}-error`);0==n.length&&(e(`[name="${t}"]`).after(`<span id="${t}-error" class="text-error custom-validation-error"></span>`),n=e(`#${t}-error`)),n.text(a)})))}).fail(function(t){e(r).text(o),console.log(t)})}function s(t,a,n){var r=e(t).closest("form"),o=t,i=a.dom.checkValidity(r[0]),s=e(t).text(),f=e(t).attr("data-processing"),l=e(r).find(".id").val(),d=function(e){var t=["g-recaptcha-response"],a=[];return e.forEach(function(e,n){-1==t.indexOf(e.name)&&a.push(e)}),JSON.stringify(a)}(r.serializeArray());i&&(""!=e(r).attr("action")&&e(r).submit(),c(r,a,o,s,f,l,d))}e.each(i,function(a,n){var i=e(n).children(".id"),c=i.val();t.call([{methodname:"edwiserform_get_form_definition",args:{form_id:c}}])[0].done(function(t){if(0!=t.status){if(r.container=n,o[a]=new Formeo(r,t.definition),o[a].render(n),e(n).prepend(`<h2>${t.title}</h2>`),e(n).prepend(i),t.data){var c=JSON.parse(t.data);e.each(c,function(t,a){e.each(e(`[name="${a.name}"]`),function(t,n){switch(n.tagName){case"INPUT":switch(n.type){case"radio":case"checkbox":n.value==a.value&&e(n).prop("checked",!0);break;default:e(n).val(a.value)}break;case"SELECT":case"TEXTAREA":e(n).val(a.value)}var r=new CustomEvent("change",{target:e(n)[0]});e(n)[0].dispatchEvent(r)})})}t.action&&""!=t.action&&function(t,a){e(t).attr("action",a)}(n,t.action),e(n).keyup(function(e){13==e.keyCode&&s(this,o[a],t.formtype)}),e(n).find("#submit-form").click(function(){s(this,o[a],t.formtype)})}else e(n).html(t.msg).addClass("empty")}).fail(function(e){console.log(e)})}),e(".step-navigation #previous-step").click(function(){}),e(".step-navigation #next-step").click(function(){})})}}});