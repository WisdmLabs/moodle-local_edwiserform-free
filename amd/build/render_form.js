"use strict";define(["jquery","core/ajax","core/notification","local_edwiserform/formviewer"],function(e,t,n){var a={DATA_DELETING:"data-deleting",DATA_PROCESSING:"data-processing"},i=null,o=[],r=!1,c={GET_FORM_DEFINITION:function(e){return t.call([{methodname:"edwiserform_get_form_definition",args:{form_id:e}}])[0]},SUBMIT_FORM_DATA:function(e,n){return t.call([{methodname:"edwiserform_submit_form_data",args:{formid:e,data:n}}])[0]}};function s(t,a,i,o,r,s,l){var f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e(i).text(r),c.SUBMIT_FORM_DATA(s,l).done(function(n){n.status?(e(t).html(n.msg),a.dom.alert("success",n.msg),null!=f&&f(t,l)):(""!=n.msg&&a.dom.alert("warning",n.msg),n.hasOwnProperty("errors")&&function(t,n){n=JSON.parse(n),e(".custom-validation-error").remove(),e.each(n,function(n,a){var i=e(t).find("#".concat(n,"-error"));0==i.length&&(e(t).find('[name="'.concat(n,'"]')).after('<span id="'.concat(n,'-error" class="text-error custom-validation-error"></span>')),i=e(t).find("#".concat(n,"-error"))),i.text(a)})}(t,n.errors)),a.dom.loadingClose(),e(i).text(o)}).fail(function(t){a.dom.loadingClose(),e(i).text(o),n.exception(t)})}function l(t,n){var i=e(t).closest("form"),o=t,r=n.dom.checkValidity(i[0]),c=e(t).text(),l=e(t).attr(a.DATA_PROCESSING),f=e(i).parent().find(".id").val();if(r){if(""!=e(i).attr("action"))return void e(i).submit();n.dom.loading(),setTimeout(function(){var e=i.serializeArray();e=function(e){var t=["g-recaptcha-response"],n=[];return e.forEach(function(e,a){-1==t.indexOf(e.name)&&n.push(e)}),JSON.stringify(n)}(e),s(i,n,o,c,l,f,e)},1e3)}}function f(t){var n={container:"",sitekey:t,localStorage:!1};o=[],i=e(".edwiserform-container"),r=e("#edwiserform-fullpage")&&e("#edwiserform-fullpage").val(),e.each(i,function(t,a){var i=e(a).children(".id"),r=i.val();c.GET_FORM_DEFINITION(r).done(function(r){0!=r.status?(n.container=a,o[t]=new Formeo(n,r.definition),o[t].render(a),e(a).prepend("<h2>".concat(r.title,"</h2>")),e(a).prepend(i),r.data&&function(t,n){var a=JSON.parse(n);e.each(a,function(n,a){e.each(e(t).find('[name="'.concat(a.name,'"]')),function(t,n){switch(n.tagName){case"INPUT":switch(n.type){case"radio":n.value==a.value&&e(n).prop("checked",!0);var i=new CustomEvent("click",{target:e(n)[0]});e(n)[0].dispatchEvent(i);break;case"checkbox":n.value==a.value&&e(n).prop("checked",!0);break;default:e(n).val(a.value)}break;case"SELECT":if(e(n).is('[multiple="true"]')){var o=e(n).val();o.push(a.value),a.value=o}case"TEXTAREA":e(n).val(a.value)}i=new CustomEvent("change",{target:e(n)[0]}),e(n)[0].dispatchEvent(i),""!=e(n).val()&&e(n).parents(".f-field-group").addClass("active")})})}(a,r.data),r.action&&""!=r.action&&function(t,n){e(t).attr("action",n)}(a,r.action),e(a).keyup(function(e){13==e.keyCode&&l(this,o[t],r.formtype)}),e(a).find("#submit-form").click(function(){l(this,o[t],r.formtype)})):e(a).html(r.msg).addClass("empty")}).fail(function(e){console.log(e)})})}return{init:function(t){e(document).ready(function(n){f(t),e(window).resize(function(){e.each(i,function(e){o[e].dom.manageFormWidth(r)})}),e(".step-navigation #previous-step").click(function(){}),e(".step-navigation #next-step").click(function(){}),e("body").on("click",".efb-view-fullpage",function(){var t=e(this).closest(".edwiserform-container").find('input[class="id"]').val();window.open(M.cfg.wwwroot+"/local/edwiserform/form.php?id="+t),e(this).closest(".edwiserform-container").html(M.util.get_string("fullpage-link-clicked","local_edwiserform"))})})}}});