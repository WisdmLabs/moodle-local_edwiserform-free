"use strict";define(["jquery","core/ajax","local_edwiserform/formviewer"],function(e,t){return{init:function(n){e(document).ready(function(a){var o={container:"",sitekey:n,localStorage:!1},r=[],i=e(".edwiserform-container");function c(n,a,o,r,i,c,s){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e(o).text(i),t.call([{methodname:"edwiserform_submit_form_data",args:{formid:c,data:s}}])[0].done(function(t){var o;t.status?(e(n).html(t.msg),a.dom.alert("success",t.msg),null!=l&&l(n,s)):(a.dom.alert("warning",t.msg),t.hasOwnProperty("errors")&&(o=t.errors,o=JSON.parse(o),e(".custom-validation-error").remove(),e.each(o,function(t,n){var a=e("#".concat(t,"-error"));0==a.length&&(e('[name="'.concat(t,'"]')).after('<span id="'.concat(t,'-error" class="text-error custom-validation-error"></span>')),a=e("#".concat(t,"-error"))),a.text(n)})))}).fail(function(t){e(o).text(r),console.log(t)})}function s(t,n,a){var o=e(t).closest("form"),r=t,i=n.dom.checkValidity(o[0]),s=e(t).text(),l=e(t).attr("data-processing"),f=e(o).find(".id").val(),d=function(e){var t=["g-recaptcha-response"],n=[];return e.forEach(function(e,a){-1==t.indexOf(e.name)&&n.push(e)}),JSON.stringify(n)}(o.serializeArray());i&&(""!=e(o).attr("action")&&e(o).submit(),c(o,n,r,s,l,f,d))}e.each(i,function(n,a){var i=e(a).children(".id"),c=i.val();t.call([{methodname:"edwiserform_get_form_definition",args:{form_id:c}}])[0].done(function(t){if(0!=t.status){if(o.container=a,r[n]=new Formeo(o,t.definition),r[n].render(a),e(a).prepend("<h2>".concat(t.title,"</h2>")),e(a).prepend(i),t.data){var c=JSON.parse(t.data);e.each(c,function(t,n){e.each(e('[name="'.concat(n.name,'"]')),function(t,a){switch(a.tagName){case"INPUT":switch(a.type){case"radio":a.value==n.value&&e(a).prop("checked",!0);var o=new CustomEvent("click",{target:e(a)[0]});e(a)[0].dispatchEvent(o);break;case"checkbox":a.value==n.value&&e(a).prop("checked",!0);break;default:e(a).val(n.value)}break;case"SELECT":case"TEXTAREA":e(a).val(n.value)}o=new CustomEvent("change",{target:e(a)[0]});e(a)[0].dispatchEvent(o)})})}t.action&&""!=t.action&&function(t,n){e(t).attr("action",n)}(a,t.action),e(a).keyup(function(e){13==e.keyCode&&s(this,r[n],t.formtype)}),e(a).find("#submit-form").click(function(){s(this,r[n],t.formtype)})}else e(a).html(t.msg).addClass("empty")}).fail(function(e){console.log(e)})}),e(".step-navigation #previous-step").click(function(){}),e(".step-navigation #next-step").click(function(){}),e("body").on("click",".efb-view-fullpage",function(){var t=e(this).closest(".edwiserform-container").find('input[class="id"]').val();window.open(M.cfg.wwwroot+"/local/edwiserform/form.php?id="+t),e(this).closest(".edwiserform-container").html(M.util.get_string("fullpage-link-clicked","local_edwiserform"))})})}}});