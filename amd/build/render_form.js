"use strict";define(["jquery","core/ajax","local_edwiserform/formviewer"],function(e,t){return{init:function(a){e(document).ready(function(n){var o={container:"",sitekey:a,localStorage:!1},r=[],i=e(".edwiserform-container"),c=e("#edwiserform-fullpage")&&e("#edwiserform-fullpage").val();function s(a,n,o,r,i,c,s){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e(o).text(i),t.call([{methodname:"edwiserform_submit_form_data",args:{formid:c,data:s}}])[0].done(function(t){var o;t.status?(e(a).html(t.msg),n.dom.alert("success",t.msg),null!=l&&l(a,s)):(n.dom.alert("warning",t.msg),t.hasOwnProperty("errors")&&(o=t.errors,o=JSON.parse(o),e(".custom-validation-error").remove(),e.each(o,function(t,a){var n=e("#".concat(t,"-error"));0==n.length&&(e('[name="'.concat(t,'"]')).after('<span id="'.concat(t,'-error" class="text-error custom-validation-error"></span>')),n=e("#".concat(t,"-error"))),n.text(a)})))}).fail(function(t){e(o).text(r),console.log(t)})}function l(t,a,n){var o=e(t).closest("form"),r=t,i=a.dom.checkValidity(o[0]),c=e(t).text(),l=e(t).attr("data-processing"),f=e(o).find(".id").val(),d=function(e){var t=["g-recaptcha-response"],a=[];return e.forEach(function(e,n){-1==t.indexOf(e.name)&&a.push(e)}),JSON.stringify(a)}(o.serializeArray());i&&(""!=e(o).attr("action")&&e(o).submit(),s(o,a,r,c,l,f,d))}e(window).resize(function(){e.each(i,function(e){r[e].dom.manageFormWidth(c)})}),e.each(i,function(a,n){var i=e(n).children(".id"),c=i.val();t.call([{methodname:"edwiserform_get_form_definition",args:{form_id:c}}])[0].done(function(t){0!=t.status?(o.container=n,r[a]=new Formeo(o,t.definition),r[a].render(n),e(n).prepend("<h2>".concat(t.title,"</h2>")),e(n).prepend(i),t.data&&function(t,a){var n=JSON.parse(a);e.each(n,function(a,n){e.each(e(t).find('[name="'.concat(n.name,'"]')),function(t,a){switch(a.tagName){case"INPUT":switch(a.type){case"radio":a.value==n.value&&e(a).prop("checked",!0);var o=new CustomEvent("click",{target:e(a)[0]});e(a)[0].dispatchEvent(o);break;case"checkbox":a.value==n.value&&e(a).prop("checked",!0);break;default:e(a).val(n.value)}break;case"SELECT":if(e(a).is('[multiple="true"]')){var r=e(a).val();r.push(n.value),n.value=r}case"TEXTAREA":e(a).val(n.value)}o=new CustomEvent("change",{target:e(a)[0]}),e(a)[0].dispatchEvent(o)})})}(n,t.data),t.action&&""!=t.action&&function(t,a){e(t).attr("action",a)}(n,t.action),e(n).keyup(function(e){13==e.keyCode&&l(this,r[a],t.formtype)}),e(n).find("#submit-form").click(function(){l(this,r[a],t.formtype)})):e(n).html(t.msg).addClass("empty")}).fail(function(e){console.log(e)})}),e(".step-navigation #previous-step").click(function(){}),e(".step-navigation #next-step").click(function(){}),e("body").on("click",".efb-view-fullpage",function(){var t=e(this).closest(".edwiserform-container").find('input[class="id"]').val();window.open(M.cfg.wwwroot+"/local/edwiserform/form.php?id="+t),e(this).closest(".edwiserform-container").html(M.util.get_string("fullpage-link-clicked","local_edwiserform"))})})}}});