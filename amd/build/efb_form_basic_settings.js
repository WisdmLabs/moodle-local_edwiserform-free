"use strict";define(["jquery"],function(i){i(document).ready(function(){function e(e,t){var n=["primary","warning","success","info"],a=document.createElement("span");i(a).html(t),i(a).attr("data-email",t),i(a).attr("class","email-tag btn btn-".concat(n[Math.floor(Math.random()*n.length)]));var o=document.createElement("span");i(o).attr("class","email-tag-delete"),i(o).html("X"),i(a).append(i(o)),i(a).insertBefore(i(".notifi-email-group").children()[e])}function t(t){if(-1!=a){var r=i(t).data("index");switch(function(i,e){return/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(e)?-1!=n.indexOf(e)&&n.indexOf(e)!=i?2:1:0}(r,i(t).val())){case 0:return void o(M.util.get_string("efb-lbl-notifi-email-warning","local_edwiserform"));case 1:a=-1;var d=i(t).val();return i(t).remove(),e(r,d),n[r]=d,i("#id_notifi_email").val(n.join(",")),void l();case 2:return void o(M.util.get_string("efb-lbl-notifi-email-duplicate","local_edwiserform"))}}}i("#id_notifi_email").parent().prepend('<div class="notifi-email-group"><input type="email" class="notifi-email-group-input form-control" id="notifi-email-group-input"/></div>'),i("#id_notifi_email").hide();var n=i("#id_notifi_email").val().trim(),a=-1;function o(e){i("#id_error_notifi_email").html(e),i("#id_error_notifi_email").show(),i("#id_error_notifi_email").parent(".felement").addClass("has-danger")}function l(){i("#id_error_notifi_email").hide().parent(".felement").removeClass("has-danger"),i("#id_notifi_email").val(n.join(","))}function r(t){if(""!=i(t).val())switch(function(i){return/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(i)?-1!=n.indexOf(i)?2:1:0}(i(t).val())){case 0:return void o(M.util.get_string("efb-lbl-notifi-email-warning","local_edwiserform"));case 1:var a=i(t).siblings(".email-tag").length,r=i(t).val().trim();return e(a,r),n.push(r),i(t).val(""),void l();case 2:return void o(M.util.get_string("efb-lbl-notifi-email-duplicate","local_edwiserform"))}else l()}n=n.length>0?n.split(","):[],i.each(n,function(i,t){e(i,t)}),i("body").on("click",".email-tag-delete",function(){var e=i(this).parent(),t=i(".email-tag").index(e);n.splice(t,1),e.remove(),i("#id_notifi_email").val(n.join(","))}),i("body").on("dblclick",".email-tag",function(){!function(e){var t=i(e).data("email"),n=i(".email-tag").index(e);a=n;var o=document.createElement("input");i(e).remove(),i(o).val(t),i(o).attr("class","notifi-email-group-edit"),i(o).attr("data-index",n),i(o).insertBefore(i(".notifi-email-group").children()[n]),i(o).focus()}(i(this))}),i("body").on("focusout",".notifi-email-group-edit",function(e){t(i(this))}),i("body").on("keyup",".notifi-email-group-edit",function(e){13!=e.keyCode&&27!=e.keyCode||t(i(this))}),i("body").on("keyup","#notifi-email-group-input",function(e){13==e.keyCode||32==e.keyCode?r(this):188==e.keyCode&&(i(this).val(i(this).val().slice(0,-1)),r(this))}),i("body").on("focusout","#notifi-email-group-input",function(i){i.preventDefault(),r(this)})})});