{"version":3,"sources":["efb_form_basic_settings.js"],"names":["define","$","document","ready","addEmail","index","email","classes","emailElement","createElement","html","attr","concat","Math","floor","random","length","deleteEmail","append","insertBefore","children","changeToEmailTag","edit","editing","data","test","emails","indexOf","validateEditEmail","val","showEmailError","M","util","get_string","remove","join","hideEmailError","get_body_tags","tags","container","each","tag","info","parent","prepend","hide","after","id","string","click","this","on","next","toggleClass","text","hasClass","parents","siblings","trim","show","addClass","removeClass","checkAndAdd","elem","validateEmail","nextIndex","push","split","splice","focus","changeToEmailEdit","event","keyCode","slice","preventDefault"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\ndefine(['jquery'], function ($) {\n    $(document).ready(function() {\n        function validateEmail(email) {\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {\n                if (emails.indexOf(email) != -1) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n        function validateEditEmail(index, email) {\n            var filter = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n            if (filter.test(email)) {;\n                if (emails.indexOf(email) != -1 && emails.indexOf(email) != index) {\n                    return 2;\n                }\n                return 1;\n            }\n            return 0;\n\n        }\n        function addEmail(index, email) {\n            var classes = [\n                'primary',\n                'warning',\n                'success',\n                'info',\n            ];\n            var emailElement = document.createElement(\"span\");\n            $(emailElement).html(email);\n            $(emailElement).attr(\"data-email\", email);\n            $(emailElement).attr(\"class\", `email-tag btn btn-${classes[Math.floor((Math.random()*classes.length))]}`);\n            var deleteEmail = document.createElement(\"span\");\n            $(deleteEmail).attr(\"class\", \"email-tag-delete\");\n            $(deleteEmail).html(\"X\");\n            $(emailElement).append($(deleteEmail));\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n        }\n        function changeToEmailEdit(tag) {\n            let email = $(tag).data('email');\n            let index = $(\".email-tag\").index(tag);\n            editing = index;\n            var emailElement = document.createElement(\"input\");\n            $(tag).remove();\n            $(emailElement).val(email);\n            $(emailElement).attr(\"class\", \"notifi-email-group-edit\");\n            $(emailElement).attr(\"data-index\", index);\n            $(emailElement).insertBefore($(\".notifi-email-group\").children()[index]);\n            $(emailElement).focus();\n        }\n        function changeToEmailTag(edit) {\n            if (editing != -1) {\n                var index = $(edit).data('index');\n                var status = validateEditEmail(index, $(edit).val());\n                switch (status) {\n                    case 0:\n                        showEmailError(M.util.get_string(\"lbl-notifi-email-warning\", \"local_edwiserform\"));\n                        return;\n                    case 1:\n                        editing = -1;\n                        let email = $(edit).val();\n                        $(edit).remove();\n                        addEmail(index, email);\n                        emails[index] = email;\n                        $(\"#id_notifi_email\").val(emails.join(','));\n                        hideEmailError();\n                        return;\n                    case 2:\n                        showEmailError(M.util.get_string(\"lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                        return;\n                }\n            }\n        }\n        $(\"#id_notifi_email\").parent().prepend(`<div class=\"notifi-email-group\"><input type=\"email\" class=\"notifi-email-group-input form-control\" id=\"notifi-email-group-input\"/><div>${M.util.get_string('recipient-email-desc', 'local_edwiserform')}</div></div>`);\n        $(\"#id_notifi_email\").hide();\n        $('#id_notifi_email_body').after(M.util.get_string('email-body-restore-desc', 'local_edwiserform', {\n            id: '#id_notifi_email_bodyeditable',\n            string: 'notify-email-body'\n        }));\n        $('#id_confirmation_msg').after(M.util.get_string('email-body-restore-desc', 'local_edwiserform', {\n            id: '#id_confirmation_msgeditable',\n            string: 'confirmation-default-msg'\n        }));\n        $('.efb-email-body-restore').click(function() {\n            $($(this).data('id')).html(M.util.get_string($(this).data('string'), 'local_edwiserform'))\n        });\n        function get_body_tags() {\n            var tags = M.util.get_string('email-body-tags', 'local_edwiserform');\n            var container = \"<div class='efb-email-tags show'><ul>\";\n            $.each(tags, function(tag, info) {\n                container += `<li>\n                <a href=\"#\" class=\"efb-email-tag\" title=\"${info}\">${tag}\n                <label class=\"efb-forms-pro-label m-0\">${M.util.get_string('pro-label', 'local_edwiserform')}</label></a></li>`;\n            });\n            return container += \"</ul></div>\";\n        }\n        $('body').on('click', '.efb-email-show-tags>a', function() {\n            $(this).next().toggleClass('show');\n            $(this).text($(this).next().hasClass('show') ? M.util.get_string('email-hide-tags', 'local_edwiserform') : M.util.get_string('email-show-tags', 'local_edwiserform'));\n        });\n        $(\"#id_notifi_email_body\").parents('.felement').siblings().append(\n            `<div class=\"efb-email-show-tags\">\n                <a href=\"#\">${M.util.get_string('email-hide-tags', 'local_edwiserform')}</a>\n                ${get_body_tags()}\n            </div>`\n        );\n        $(\"#id_confirmation_msg\").parents('.felement').siblings().append(\n            `<div class=\"efb-email-show-tags\">\n                <a href=\"#\">${M.util.get_string('email-hide-tags', 'local_edwiserform')}</a>\n                ${get_body_tags()}\n            </div>`\n        );\n        var emails = $(\"#id_notifi_email\").val().trim();\n        var editing = -1;\n        if (emails.length > 0) {\n            emails = emails.split(\",\");\n        } else {\n            emails = [];\n        }\n        $.each(emails, function(index, email) {\n            addEmail(index, email);\n        });\n        $(\"body\").on(\"click\", \".email-tag-delete\", function() {\n            var email = $(this).parent();\n            var index = $(\".email-tag\").index(email);\n            emails.splice(index, 1);\n            email.remove();\n            $(\"#id_notifi_email\").val(emails.join(','));\n        });\n        $(\"body\").on(\"dblclick\", \".email-tag\", function() {\n            changeToEmailEdit($(this));\n        });\n        $(\"body\").on(\"focusout\", \".notifi-email-group-edit\", function(event) {\n            changeToEmailTag($(this));\n        });\n        $(\"body\").on(\"keyup\", \".notifi-email-group-edit\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 27) {\n                changeToEmailTag($(this));\n            }\n        });\n        function showEmailError(string) {\n            $(\"#id_error_notifi_email\").html(string);\n            $(\"#id_error_notifi_email\").show();\n            $(\"#id_error_notifi_email\").parent(\".felement\").addClass('has-danger');\n        }\n        function hideEmailError() {\n            $(\"#id_error_notifi_email\").hide().parent(\".felement\").removeClass('has-danger');\n            $(\"#id_notifi_email\").val(emails.join(','));\n        }\n        function checkAndAdd(elem) {\n            if ($(elem).val() == '') {\n                hideEmailError();\n                return;\n            }\n            var status = validateEmail($(elem).val());\n            switch (status) {\n                case 0:\n                    showEmailError(M.util.get_string(\"lbl-notifi-email-warning\", \"local_edwiserform\"));\n                    return;\n                case 1:\n                    var nextIndex = $(elem).siblings('.email-tag').length;\n                    var email = $(elem).val().trim();\n                    addEmail(nextIndex, email);\n                    emails.push(email);\n                    $(elem).val('');\n                    hideEmailError();\n                    return;\n                case 2:\n                    showEmailError(M.util.get_string(\"lbl-notifi-email-duplicate\", \"local_edwiserform\"));\n                    return;\n            }\n        }\n        $(\"body\").on(\"keyup\", \"#notifi-email-group-input\", function(event) {\n            if (event.keyCode == 13 || event.keyCode == 32) { //Enter key or space key\n                checkAndAdd(this);\n            } else if (event.keyCode == 188) { //Comma key\n                $(this).val($(this).val().slice(0, -1));\n                checkAndAdd(this);\n            }\n        });\n        $(\"body\").on(\"focusout\", \"#notifi-email-group-input\", function(event) {\n            event.preventDefault();\n            checkAndAdd(this);\n        });\n    });\n});\n"],"file":"efb_form_basic_settings.js"}