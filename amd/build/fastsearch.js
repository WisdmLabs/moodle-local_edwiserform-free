"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=t(window.document),s=0,n=/\w\b/g,i={13:"enter",27:"escape",40:"downArrow",38:"upArrow"};function o(t,e){this.init.apply(this,arguments)}return t.extend(o.prototype,{init:function(e,n){n=this.options=t.extend(!0,{},o.defaults,n),this.$input=t(e),this.$el=n.wrapSelector instanceof t?n.wrapSelector:this.$input.closest(n.wrapSelector),o.pickTo(n,this.$el.data(),["url","onItemSelect","noResultsText","inputIdName","apiInputName"]),n.url=n.url||this.$el.attr("action"),this.ens=".fastsearch"+ ++s,this.itemSelector=o.selectorFromClass(n.itemClass),this.focusedItemSelector=o.selectorFromClass(n.focusedItemClass),this.events()},namespaceEvents:function(t){var e=this.ens;return t.replace(n,function(t){return t+e})},events:function(){var e=this,s=this.options;this.$input.on(this.namespaceEvents("keyup focus click"),function(t){"enter"!==i[t.keyCode]&&e.handleTyping()}).on(this.namespaceEvents("keydown"),function(t){if("enter"===i[t.keyCode]&&s.preventSubmit&&t.preventDefault(),e.hasResults&&e.resultsOpened)switch(i[t.keyCode]){case"downArrow":t.preventDefault(),e.navigateItem("down");break;case"upArrow":t.preventDefault(),e.navigateItem("up");break;case"enter":e.onEnter(t)}}),this.$el.on(this.namespaceEvents("click"),this.itemSelector,function(s){s.preventDefault(),e.handleItemSelect(t(this))}),s.mouseEvents&&this.$el.on(this.namespaceEvents("mouseleave"),this.itemSelector,function(e){t(this).removeClass(s.focusedItemClass)}).on(this.namespaceEvents("mouseenter"),this.itemSelector,function(n){e.$resultItems.removeClass(s.focusedItemClass),t(this).addClass(s.focusedItemClass)})},handleTyping:function(){var e=t.trim(this.$input.val()),s=this;e.length<this.options.minQueryLength?this.hideResults():e===this.query?this.showResults():(clearTimeout(this.keyupTimeout),this.keyupTimeout=setTimeout(function(){s.$el.addClass(s.options.loadingClass),s.query=e,s.getResults(function(t){s.showResults(s.storeResponse(t).generateResults(t))})},this.options.typeTimeout))},getResults:function(e){var s=this,n=this.options,i=this.$el.find("input, textarea, select").serializeArray();n.apiInputName&&i.push({name:n.apiInputName,value:this.$input.val()}),t.get(n.url,i,function(t){e(n.parseResponse?n.parseResponse.call(s,t,s):t)})},storeResponse:function(t){return this.responseData=t,this.hasResults=0!==t.length,this},generateResults:function(e){var s=t("<div>"),n=this.options;return n.template?t(n.template(e,this)):(0===e.length?s.html('<p class="'+n.noResultsClass+'">'+("function"==typeof n.noResultsText?n.noResultsText.call(this):n.noResultsText)+"</p>"):"html"===this.options.responseType?s.html(e):this["generate"+(e[0][n.responseFormat.groupItems]?"GroupedResults":"SimpleResults")](e,s),s.children())},generateSimpleResults:function(e,s){var n=this;this.itemModels=e,t.each(e,function(t,e){s.append(n.generateItem(e))})},generateGroupedResults:function(e,s){var n=this,i=this.options,o=i.responseFormat;this.itemModels=[],t.each(e,function(e,l){var a=t('<div class="'+i.groupClass+'">').appendTo(s);l[o.groupCaption]&&a.append('<h3 class="'+i.groupTitleClass+'">'+l[o.groupCaption]+"</h3>"),t.each(l.items,function(t,e){n.itemModels.push(e),a.append(n.generateItem(e))}),i.onGroupCreate&&i.onGroupCreate.call(n,a,l,n)})},generateItem:function(e){var s=this.options,n=s.responseFormat,i=e[n.url],o=e[n.html]||e[n.label],l=t("<"+(i?"a":"span")+">").html(o).addClass(s.itemClass);return i&&l.attr("href",i),s.onItemCreate&&s.onItemCreate.call(this,l,e,this),l},showResults:function(e){!e&&this.resultsOpened||(this.$el.removeClass(this.options.loadingClass).addClass(this.options.resultsOpenedClass),this.options.flipOnBottom&&this.checkDropdownPosition(),this.$resultsCont=this.$resultsCont||t("<div>").addClass(this.options.resultsContClass).appendTo(this.$el),e&&(this.$resultsCont.html(e),this.$resultItems=this.$resultsCont.find(this.itemSelector),this.options.onResultsCreate&&this.options.onResultsCreate.call(this,this.$resultsCont,this.responseData,this)),this.resultsOpened||(this.documentCancelEvents("on"),this.$input.trigger("openingResults")),this.options.focusFirstItem&&this.$resultItems&&this.$resultItems.length&&this.navigateItem("down"),this.resultsOpened=!0)},checkDropdownPosition:function(){var t=this.options.flipOnBottom,s="boolean"==typeof t&&t?400:t,n=this.$input.offset().top+s>e.height();this.$el.toggleClass(this.options.resultsFlippedClass,n)},documentCancelEvents:function(s,n){var o=this;if("off"===s&&this.closeEventsSetuped)return e.off(this.ens),void(this.closeEventsSetuped=!1);"on"!==s||this.closeEventsSetuped||(e.on(this.namespaceEvents("click keyup"),function(e){("escape"===i[e.keyCode]||!t(e.target).is(o.$el)&&!t.contains(o.$el.get(0),e.target)&&t.contains(document.documentElement,e.target))&&(n?n.call(o):o.hideResults())}),this.closeEventsSetuped=!0)},navigateItem:function(t){var e=this.$resultItems.filter(this.focusedItemSelector),s=this.$resultItems.length-1;if(0!==e.length){var n=this.$resultItems.index(e),i="up"===t?n-1:n+1;i>s&&(i=0),i<0&&(i=s),e.removeClass(this.options.focusedItemClass),this.$resultItems.eq(i).addClass(this.options.focusedItemClass)}else this.$resultItems.eq("up"===t?s:0).addClass(this.options.focusedItemClass)},navigateDown:function(){this.navigateItem("down")},navigateUp:function(){this.navigateItem("up")},onEnter:function(t){var e=this.$resultItems.filter(this.focusedItemSelector);e.length&&(t.preventDefault(),this.handleItemSelect(e))},handleItemSelect:function(t){var e=this.options.onItemSelect,s=this.itemModels.length?this.itemModels[this.$resultItems.index(t)]:{};this.$input.trigger("itemSelected"),"fillInput"===e?this.fillInput(s):"follow"===e?window.location.href=t.attr("href"):"function"==typeof e&&e.call(this,t,s,this)},fillInput:function(e){var s=this.options,n=s.responseFormat;if(this.query=e[n.label],this.$input.val(e[n.label]).trigger("change"),s.fillInputId&&e.id){if(!this.$inputId){var i=s.inputIdName||this.$input.attr("name")+"_id";this.$inputId=this.$el.find('input[name="'+i+'"]'),this.$inputId.length||(this.$inputId=t('<input type="hidden" name="'+i+'" />').appendTo(this.$el))}this.$inputId.val(e.id).trigger("change")}this.hideResults()},hideResults:function(){return this.resultsOpened&&(this.resultsOpened=!1,this.$el.removeClass(this.options.resultsOpenedClass),this.$input.trigger("closingResults"),this.documentCancelEvents("off")),this},clear:function(){return this.hideResults(),this.$input.val("").trigger("change"),this},destroy:function(){e.off(this.ens),this.$input.off(this.ens),this.$el.off(this.ens).removeClass(this.options.resultsOpenedClass).removeClass(this.options.loadingClass),this.$resultsCont&&(this.$resultsCont.remove(),delete this.$resultsCont),delete this.$el.data().fastsearch}}),t.extend(o,{pickTo:function(e,s,n){return t.each(n,function(t,n){e[n]=s&&s[n]||e[n]}),e},selectorFromClass:function(t){return"."+t.replace(/\s/g,".")}}),o.defaults={wrapSelector:"form",url:null,responseType:"JSON",preventSubmit:!1,resultsContClass:"fs_results",resultsOpenedClass:"fsr_opened",resultsFlippedClass:"fsr_flipped",groupClass:"fs_group",itemClass:"fs_result_item",groupTitleClass:"fs_group_title",loadingClass:"loading",noResultsClass:"fs_no_results",focusedItemClass:"focused",typeTimeout:140,minQueryLength:2,template:null,mouseEvents:!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),focusFirstItem:!1,flipOnBottom:!1,responseFormat:{url:"url",html:"html",label:"label",groupCaption:"caption",groupItems:"items"},fillInputId:!0,inputIdName:null,apiInputName:null,noResultsText:"No results found",onItemSelect:"follow",parseResponse:null,onResultsCreate:null,onGroupCreate:null,onItemCreate:null},t.fastsearch=o,t.fn.fastsearch=function(e){var s=null;return this.each(function(){t.data(this,"fastsearch")?s=t.data(this,"fastsearch"):(s=new o(this,e),t.data(this,"fastsearch",s))}),s},t});