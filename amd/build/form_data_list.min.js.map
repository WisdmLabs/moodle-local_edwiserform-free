{"version":3,"sources":["form_data_list.js"],"names":["define","$","Ajax","Templates","Notification","updateSeparator","length","each","index","tr","find","remove","actions","slice","after","init","formid","PROMISES","DELETE_SUBMISSION","ids","call","methodname","args","id","submissions","GET_FORM_SUBMISSIONS","search","start","table","deleteSubmissions","Formeo","dom","multiActions","M","util","get_string","title","type","action","loading","done","response","status","alert","msg","draw","prop","loadingClose","fail","ex","exception","document","ready","DataTable","paging","ordering","bProcessing","bServerSide","rowId","bDeferRender","scrollY","scrollX","scrollCollapse","fixedColumns","leftColumns","classes","sScrollHeadInner","language","sSearch","emptyTable","info","end","total","infoEmpty","buttons","ajax","data","callback","settings","value","drawCallback","removeClass","window","rendered","render","wwwroot","cfg","html","js","replaceNode","on","this","is","event","preventDefault","val","toaster","i","e","push","parent","closest","text","addClass","columns","adjust"],"mappings":"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","sourcesContent":["/*\n * Edwiser_Forms - https://edwiser.org/\n * Version: 0.1.0\n * Author: Yogesh Shirsath\n */\n/* eslint-disable babel/object-curly-spacing, no-undef */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    'core/notification',\n    'local_edwiserform/jquery.dataTables',\n    'local_edwiserform/dataTables.bootstrap4',\n    'local_edwiserform/fixedColumns.bootstrap4',\n    'local_edwiserform/buttons.bootstrap4',\n    './iefixes',\n    'local_edwiserform/formbuilder'\n], function($, Ajax, Templates, Notification) {\n    var updateSeparator = function() {\n        if ($('.DTFC_LeftBodyLiner tr').length == 0) {\n            return;\n        }\n        $('.DTFC_LeftBodyLiner tr').each(function(index, tr) {\n            $(tr).find('.efb-data-actions span').remove();\n            var actions = $(tr).find('.efb-data-action.show');\n            if (actions.length < 2) {\n                return;\n            }\n            actions.slice(0, actions.length - 1).after('<span> | </span>');\n        });\n    };\n    return {\n        init: function(formid) {\n            var PROMISES = {\n                /**\n                 * Ajax promise to delete form submission by ids\n                 * @param  {Array}   ids Ids array of submission\n                 * @return {Promise}     Ajax promise\n                 */\n                DELETE_SUBMISSION: function(ids) {\n                    return Ajax.call([{\n                        methodname: 'edwiserform_delete_submissions',\n                        args: {\n                            id: formid,\n                            submissions: ids\n                        }\n                    }])[0];\n                },\n\n                /**\n                 * Get form data using ajax\n                 * @param  {String}  search Search query\n                 * @param  {Number}  start  Start index of courses\n                 * @param  {Number}  length Number of courses\n                 * @return {Promise}        Ajax promise\n                 */\n                GET_FORM_SUBMISSIONS: function(search, start, length) {\n                    return Ajax.call([{\n                        methodname: 'edwiserform_get_form_submissions',\n                        args: {\n                            formid: formid,\n                            search: search,\n                            start: start,\n                            length: length\n                        }\n                    }])[0];\n                },\n            };\n\n            var table = null;\n            $(document).ready(function() {\n                table = $(\"#efb-form-submissions\").DataTable({\n                    paging: true,\n                    ordering: false,\n                    bProcessing: true,\n                    bServerSide: true,\n                    rowId: 'DT_RowId',\n                    bDeferRender: true,\n                    scrollY: \"400px\",\n                    scrollX: true,\n                    scrollCollapse: true,\n                    fixedColumns: {\n                        leftColumns: 2,\n                    },\n                    classes: {\n                        sScrollHeadInner: 'efb_dataTables_scrollHeadInner'\n                    },\n                    // eslint-disable-next-line max-len\n                    dom: '<\"efb-top\"<\"efb-listing\"l><\"efb-list-filtering\"f>>t<\"efb-bottom\"<\"efb-list-pagination\"p><B><\"efb-bulk\">>i',\n                    language: {\n                        sSearch: M.util.get_string('search-entry', 'local_edwiserform'),\n                        emptyTable: M.util.get_string('listformdata-empty', 'local_edwiserform'),\n                        info: M.util.get_string(\n                            'heading-listforms-showing',\n                            'local_edwiserform', { 'start': '_START_', 'end': '_END_', 'total': '_TOTAL_' }\n                        ),\n                        infoEmpty: M.util.get_string(\n                            'heading-listforms-showing',\n                            'local_edwiserform', { 'start': '0', 'end': '0', 'total': '0' }\n                        ),\n                    },\n                    buttons: [],\n                    // eslint-disable-next-line\n                    ajax: function(data, callback, settings) {\n                        PROMISES.GET_FORM_SUBMISSIONS(\n                            data.search.value,\n                            data.start,\n                            data.length\n                        ).done(function(response) {\n                            callback(response);\n                            updateSeparator();\n                        }).fail(Notification.exception);\n                    },\n                    // eslint-disable-next-line\n                    drawCallback: function(settings) {\n                        updateSeparator();\n                        $('.efb-bottom .dt-buttons').removeClass('btn-group');\n                        window.rendered = Templates.render('local_edwiserform/bulk-actions', {\n                            formid: formid,\n                            wwwroot: M.cfg.wwwroot\n                        });\n                        window.rendered.done(function(html, js) {\n                                Templates.replaceNode($('.efb-bulk'), html, js);\n                            })\n                            .fail(Notification.exception);\n                        $('.efb-shortcode-copy-note').html(M.util.get_string('clickonshortcode', 'local_edwiserform'));\n                    }\n                });\n            });\n\n            /**\n             * Delete submission from ids passed in parameter\n             * @param  {Array} ids Ids array of submissions\n             */\n            function deleteSubmissions(ids) {\n                Formeo.dom.multiActions(\n                    'warning',\n                    M.util.get_string('deletesubmission', 'local_edwiserform'),\n                    M.util.get_string('deletesubmissionmsg', 'local_edwiserform'), [{\n                        title: M.util.get_string('proceed', 'local_edwiserform'),\n                        type: 'danger',\n                        action: function() {\n                            Formeo.dom.loading();\n                            PROMISES.DELETE_SUBMISSION(ids).done(function(response) {\n                                if (response.status == true) {\n                                    Formeo.dom.alert('success', '<div class=\"col-12\">' + response.msg + '</div>');\n                                    table.draw();\n                                    $('.submission-check-all').prop('checked', false);\n                                }\n                                Formeo.dom.loadingClose();\n                            }).fail(function(ex) {\n                                Notification.exception(ex);\n                                Formeo.dom.loadingClose();\n                            });\n                        }\n                    }, {\n                        title: M.util.get_string('cancel', 'local_edwiserform'),\n                        type: 'success'\n                    }]\n                );\n            }\n\n            // Select All/None checkbox.\n            $('body').on('change', '.submission-check-all', function() {\n                $('.DTFC_Cloned .submission-check').prop('checked', $(this).is(':checked'));\n            });\n\n            // Apply bulk actions.\n            $('body').on('click', '#efb-apply-actions', function(event) {\n                event.preventDefault();\n                switch ($('#efb-bulk-actions').val()) {\n                    case 'bulkaction':\n                        // Show toaster if bulk action is not selected.\n                        // eslint-disable-next-line\n                        Formeo.dom.toaster(M.util.get_string('selectbulkaction', 'local_edwiserform'));\n                        break;\n                    case 'delete':\n                        // Show toaster if deletiong submission without selecting any.\n                        if (!$('.submission-check').is(':checked')) {\n                            // eslint-disable-next-line\n                            Formeo.dom.toaster(M.util.get_string('emptysubmission', 'local_edwiserform'));\n                            return;\n                        }\n\n                        var ids = [];\n                        // Prepare ids array to delete.\n                        $('.submission-check:checked').each(function(i, e) {\n                            ids.push($(e).data('value'));\n                        });\n                        deleteSubmissions(ids);\n                        break;\n                }\n            });\n\n            $('body').on('click', '.efb-data-action.delete-action', function(event) {\n                event.preventDefault();\n                deleteSubmissions([$(this).data('value')]);\n            });\n\n            $('body').on('click', '.efb-actions a', function(event) {\n                event.preventDefault();\n            });\n\n            // Toggle long data in table cells.\n            $('body').on('click', '.data-toggler', function() {\n                let parent = $(this).closest('.efb-table-data-expand');\n                if (parent.is('.expanded')) {\n                    parent.removeClass('expanded');\n                    parent.find('.table-data').html(parent.data('short'));\n                    $(this).text(M.util.get_string('readmore', 'local_edwiserform'));\n                } else {\n                    parent.addClass('expanded');\n                    parent.find('.table-data').html(parent.data('long'));\n                    $(this).text(M.util.get_string('readless', 'local_edwiserform'));\n                }\n                table.columns.adjust();\n            });\n        }\n    };\n});"],"file":"form_data_list.min.js"}